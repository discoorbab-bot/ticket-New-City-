import discord
from discord.ext import commands
from discord.ui import Button, View
import asyncio

# --- ÙƒÙˆØ¯ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ°ÙƒØ±Ø© ---

class TicketView(discord.ui.View):
    def __init__(self):
        super().__init__(timeout=None) # ÙŠØ¨Ù‚Ù‰ Ø§Ù„Ø²Ø± Ø´ØºØ§Ù„ Ø¯Ø§Ø¦Ù…Ø§Ù‹

    @discord.ui.button(label="ÙØªØ­ ØªØ°ÙƒØ±Ø© ğŸ«", style=discord.ButtonStyle.success, custom_id="open_ticket")
    async def open_ticket(self, interaction: discord.Interaction, button: discord.ui.Button):
        guild = interaction.guild
        user = interaction.user
        
        # Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª (Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§Ù„Ø¨ÙˆØª ÙÙ‚Ø· ÙŠØ´ÙˆÙÙˆØ§ Ø§Ù„Ù‚Ù†Ø§Ø©)
        overwrites = {
            guild.default_role: discord.PermissionOverwrite(view_channel=False),
            user: discord.PermissionOverwrite(view_channel=True, send_messages=True, read_message_history=True),
            guild.me: discord.PermissionOverwrite(view_channel=True, send_messages=True)
        }

        # Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù‚Ù†Ø§Ø©
        channel = await guild.create_text_channel(f'ticket-{user.name}', overwrites=overwrites)
        
        # Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ÙŠØ© Ø¯Ø§Ø®Ù„ Ø§Ù„ØªØ°ÙƒØ±Ø© Ù…Ø¹ Ø²Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
        embed = discord.Embed(
            title="ğŸ« | Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ",
            description=f"Ù…Ø±Ø­Ø¨Ø§Ù‹ {user.mention}ØŒ Ø³ÙŠÙ‚ÙˆÙ… ÙØ±ÙŠÙ‚ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø¨Ø§Ù„Ø±Ø¯ Ø¹Ù„ÙŠÙƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹.\nØ§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ø£Ø¯Ù†Ø§Ù‡ Ù„Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªØ°ÙƒØ±Ø©.",
            color=0xe67e22
        )
        
        await channel.send(embed=embed, view=CloseTicketView())
        await interaction.response.send_message(f"ØªÙ… ÙØªØ­ ØªØ°ÙƒØ±ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­: {channel.mention}", ephemeral=True)

class CloseTicketView(discord.ui.View):
    def __init__(self):
        super().__init__(timeout=None)

    @discord.ui.button(label="Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªØ°ÙƒØ±Ø© ğŸ”’", style=discord.ButtonStyle.red, custom_id="close_ticket")
    async def close_ticket(self, interaction: discord.Interaction, button: discord.ui.Button):
        await interaction.response.send_message("Ø³ÙŠØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªØ°ÙƒØ±Ø© ÙˆØ­Ø°Ù Ø§Ù„Ù‚Ù†Ø§Ø© Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†Ù...")
        await asyncio.sleep(5)
        await interaction.channel.delete()

# --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨ÙˆØª ---

class Bot(commands.Bot):
    def __init__(self):
        intents = discord.Intents.all()
        super().__init__(command_prefix="!", intents=intents)

    async def on_ready(self):
        print(f'Logged in as {self.user}')
        # Ø±Ø¨Ø· Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ù„ØªØ¨Ù‚Ù‰ Ø´ØºØ§Ù„Ø© Ø­ØªÙ‰ Ø¨Ø¹Ø¯ Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª
        self.add_view(TicketView())
        self.add_view(CloseTicketView())

bot = Bot()

@bot.command()
@commands.has_permissions(administrator=True)
async def setup_ticket(ctx):
    embed = discord.Embed(
        title="ğŸ« ØªØ°Ø§ÙƒØ± Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ",
        description="Ø¥Ø°Ø§ ÙƒÙ†Øª ØªÙˆØ§Ø¬Ù‡ Ù…Ø´ÙƒÙ„Ø© Ø£Ùˆ ØªØ±ÙŠØ¯ ØªÙ‚Ø¯ÙŠÙ… Ø¨Ù„Ø§ØºØŒ Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ø£Ø¯Ù†Ø§Ù‡ Ù„ÙØªØ­ ØªØ°ÙƒØ±Ø© Ø®Ø§ØµØ© Ø¨Ùƒ.",
        color=0xe67e22
    )
    await ctx.send(embed=embed, view=TicketView())

# --- ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª ---
# Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ø³ØªØ¨Ø¯Ù„ 'YOUR_TOKEN_HERE' Ø¨Ø§Ù„ØªÙˆÙƒÙ† Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
bot.run('MTM4NjUzMjE1NjQ3NzY2OTM5Ng.Gjs2cJ.oqloG2GL5SEtVnXQoJmM-Pki8ma7qJODGLjj2k')
